var v=Object.defineProperty;var b=(a,h,e)=>h in a?v(a,h,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[h]=e;var t=(a,h,e)=>b(a,typeof h!="symbol"?h+"":h,e);(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();class f{constructor(h,e,i,s,r,n,m){t(this,"game");t(this,"img");t(this,"width");t(this,"height");t(this,"x");t(this,"y");t(this,"speed");this.game=h,this.img=new Image,this.img.src=e,this.width=i,this.height=s,this.x=r,this.y=n,this.speed=m}update(h){this.x<=-this.width&&(this.x=0),this.x-=this.game.speed*this.speed}draw(h){h.drawImage(this.img,this.x,this.y,this.width,this.height)}}class p{constructor(h){t(this,"game");t(this,"keys");t(this,"x");t(this,"y");this.game=h,this.keys=new Set,this.x=0,this.y=0,window.addEventListener("keydown",e=>{this.keys.add(e.key)}),window.addEventListener("keyup",e=>{this.keys.delete(e.key)}),window.addEventListener("mousemove",e=>{this.x,this.y=e.x,e.y})}has(h){return this.keys.has(h)}}class o{constructor(h,e,i,s,r,n,m,d){t(this,"game");t(this,"x");t(this,"y");t(this,"width");t(this,"height");t(this,"color");t(this,"currentSpeed",0);t(this,"maxSpeedX");t(this,"maxSpeedY");t(this,"directionX",1);t(this,"directionY",1);t(this,"health",0);this.game=h,this.x=e,this.y=i,this.width=s,this.height=r,this.color=n,this.maxSpeedX=m,this.maxSpeedY=d}update(h){this.x=this.x+this.maxSpeedX/1e3*h*this.directionX,this.x>this.game.width-this.width&&(this.directionX=-1),this.x<0&&(this.directionX=1),this.y=this.y+this.maxSpeedY/1e3*h*this.directionY,this.y>this.game.height-this.height&&(this.directionY=-1),this.y<0&&(this.directionY=1)}draw(h){h.fillStyle=this.color,h.fillRect(this.x,this.y,this.width,this.height)}}const S="/deadmoves/assets/Player_SpriteSheet_NoGrid-CEZy0N4G.png";class g extends o{constructor(e,i,s,r){super(e,i.x,i.y,s,r,"",0,0);t(this,"maxHealth");t(this,"parent");t(this,"fullVisible",!1);this.parent=i,this.maxHealth=i.health}draw(e){if(this.parent.health==this.maxHealth&&!this.fullVisible)return;const i=this.parent.x+(this.parent.width-this.width+5)/2,s=this.parent.y,r=Math.max((this.width-2)*this.parent.health/this.maxHealth,0);e.save(),e.beginPath(),e.moveTo(i+this.width+5,s),e.lineTo(i,s),e.lineTo(i,s+this.height),e.lineTo(i+this.width,s+this.height),e.closePath(),e.fillStyle="black",e.fill(),e.beginPath(),e.moveTo(i+r+5,s+2),e.lineTo(i+2,s+2),e.lineTo(i+2,s+this.height-2),e.lineTo(i+r+2,s+this.height-2),e.closePath(),e.fillStyle="red",e.fill(),e.restore()}}class Y extends o{constructor(e,i,s,r,n,m,d,l){super(e,i,s,d,l,"000",r,n);t(this,"game");t(this,"initialY");t(this,"img",new Image);t(this,"frameX",0);t(this,"frameY",0);t(this,"maxFrames",10);t(this,"timer",0);t(this,"flip",!1);t(this,"speedX",0);t(this,"speedY",0);t(this,"healthbar");t(this,"animationEnded",!1);t(this,"passiveAttacks",new Map([[2,this.yonkie],[3,this.rotate],[4,this.stir]]));t(this,"clubPengiunDanceIndice",-1);t(this,"clubPenguinDanceCollection",[this.rotate,this.stir,this.sit,this.sit,this.waveRight,this.sit,this.sit,this.waveLeft,this.sit,this.sit,this.bendLeft,this.sit,this.sit,this.bendRight]);t(this,"jumpFrame",-1);t(this,"jumpWait",0);this.game=e,this.initialY=s,this.health=m,this.healthbar=new g(e,this,d*.8,9.5),this.healthbar.fullVisible=!0,this.width=d,this.height=l,this.img.src=S}update(e,i=!1){if(!i){if((this.speedY!=0||this.initialY!==this.y)&&(this.speedY-=this.game.gravity*(e/1e3),this.y-=this.speedY*(e/1e3),this.y>=this.initialY&&(this.y=this.initialY,this.speedY=0)),this.timer>this.game.interval)this.frameX++,this.timer=0;else{this.timer+=e;return}this.frameX>=this.maxFrames&&(this.frameX=0)}if(this.frameX===0&&this.processRotatePlayer(),this.jump()||this.passiveAttack()||(this.idle(),this.processRotatePlayer()),this.animationEnded){if(i)throw new Error("rerendered frame was rerendered");this.animationEnded=!1,this.update(e,!0)}}passiveAttack(){let e=this.passiveAttacks.get(this.frameY);if(e===void 0){if(!this.game.input.has("j"))return!1;e=Array.from(this.passiveAttacks.values())[Math.floor(Math.random()*this.passiveAttacks.size)]}return e.call(this,!0)?(this.game.enemiesLeft.enemies.forEach(i=>{i.updateHealth(Math.random()*2)}),this.game.enemiesRight.enemies.forEach(i=>{i.updateHealth(Math.random()*2)}),!0):!1}kick(e){return this.processAnimation(e,1,8)}yonkie(e){return this.processAnimation(e,2,10)}sit(e){return this.processAnimation(e,5,4)}rotate(e){return this.processAnimation(e,3,16)}stir(e){return this.processAnimation(e,4,10)}wave(e){return this.flip?this.waveRight(e):this.waveLeft(e)}waveRight(e){return this.processAnimation(e,6,10)}waveLeft(e){return this.processAnimation(e,7,10)}bend(e){return this.flip?this.bendRight(e):this.bendLeft(e)}bendRight(e){return this.processAnimation(e,9,7)}bendLeft(e){return this.processAnimation(e,8,7)}clubPenguin(){if(this.clubPengiunDanceIndice===-1){if(this.frameY!==0||!this.game.input.has("p"))return!1;this.clubPengiunDanceIndice=0}return this.clubPenguinDanceCollection[this.clubPengiunDanceIndice].call(this,!0),this.animationEnded&&(this.clubPengiunDanceIndice++,this.clubPengiunDanceIndice>=this.clubPenguinDanceCollection.length?this.clubPengiunDanceIndice=-1:(this.animationEnded=!1,this.clubPenguinDanceCollection[this.clubPengiunDanceIndice].call(this,!0))),!0}directionalAnimation(){return 6<=this.frameY&&this.frameY<=9}processAnimation(e,i,s){if(this.frameY!==i&&(this.frameY!==0||!e))return!1;if(this.frameY===i){if(this.frameX===0)return this.animationEnded=!0,this.idle(),!0;if(this.frameX!==0)return!0}return this.frameY=i,this.frameX=0,this.maxFrames=s,!0}processRotatePlayer(){this.game.input.has("a")?this.flip=!0:this.game.input.has("d")&&(this.flip=!1)}idle(){this.frameY!==0&&(this.frameY=0,this.frameX=0,this.maxFrames=10)}jump(){if(this.jumpFrame===-1){if(this.frameY!==0||!this.game.input.has("w"))return!1;this.jumpFrame=0}if(this.jumpFrame===1){if(this.speedY>0)return this.frameX=1,!0;if(this.speedY!=0){this.frameX=2,this.jumpWait++;const i=s=>{s.x<this.x+this.width&&s.x+s.width>this.x&&s.y<this.y+this.height&&s.y+s.height>this.y&&s.jumpKill(!0)};return this.game.enemiesLeft.enemies.forEach(i),this.game.enemiesRight.enemies.forEach(i),!0}if(this.jumpWait<this.game.fps/3.8)return this.frameX=2,this.jumpWait++,!0}const e=[()=>{this.processAnimation(!0,2,4)},()=>{this.sit(!0)},()=>{this.processAnimation(!0,2,10),this.frameX===0&&(this.frameX=6)}];return e[this.jumpFrame](),this.jumpFrame===0&&this.frameX===3&&(this.speedY=this.maxSpeedY),this.animationEnded&&(this.jumpFrame++,this.jumpFrame>=e.length?(this.jumpWait=0,this.jumpFrame=-1):(e[this.jumpFrame](),this.animationEnded=!1)),!0}isJumping(){return this.jumpFrame===1&&(this.speedY>0||this.speedY!=0)}draw(e){const i=this.directionalAnimation()?!1:this.flip;i&&(e.save(),e.scale(-1,1)),e.drawImage(this.img,589+340*this.frameX,480*this.frameY,340,480,i?-this.x-this.width:this.x,this.y,this.width,this.height),i&&e.restore(),this.healthbar.draw(e)}}const X="/deadmoves/assets/Title_Screen-DPuS_xFQ.png";class P extends f{constructor(e){super(e,X,e.width,e.height,0,0,0);t(this,"running");t(this,"paused");t(this,"released");this.running=!1,this.paused=!1,this.released=!0,document.addEventListener("visibilitychange",()=>{document.hidden&&(this.running=!1)})}update(e){if(!this.running&&this.game.input.keys.size>0){console.debug("game started"),this.running=!0;return}if(this.running&&(this.game.input.has("Escape")||this.game.input.keys.size>0&&this.paused)){this.released&&(console.debug(this.paused?"game unpaused":"game paused"),this.paused=!this.paused,this.released=!1);return}this.released=!0}draw(e){e.drawImage(this.img,this.x,this.y,this.width,this.height),e.save();const i="<Press any key>";e.textAlign="center",e.fillStyle="#edb051",e.font='30px "Press Start 2P"',e.fillText(i,1.35*this.game.width/2,this.game.height/3,.35*this.game.width/2),e.lineWidth=1,e.strokeStyle="#c56927",e.strokeText(i,1.35*this.game.width/2,this.game.height/3,.35*this.game.width/2),e.restore()}}const A="/deadmoves/assets/Game_Over_Assembled-zbzdWSfm.png",E="/deadmoves/assets/BG-K4PAxuRa.png";class x extends f{constructor(e){super(e,A,e.width,e.height,0,0,0);t(this,"bgImg");t(this,"dead",!1);t(this,"timer",-1);t(this,"frames",0);t(this,"fps",20);t(this,"interval",1e3/this.fps);this.bgImg=new Image,this.bgImg.src=E}update(e){this.game.player.health>=1||(this.dead=!0,this.timer===-1&&(this.timer=0),this.timer+=e,this.timer>this.interval&&(this.frames+=this.timer/this.interval,this.timer%=this.interval))}draw(e){if(this.timer===-1)return;console.debug("dead"),e.drawImage(this.bgImg,this.x,this.y,this.width,this.height);const i=-this.fps/3+this.frames,s=i*.05;if(i>0&&(e.save(),e.globalAlpha=s,e.drawImage(this.img,this.x,this.y,this.width,this.height),e.restore()),s>1){let r=`Final Score: ${Math.floor(this.game.score.score)}`;const n=this.game.width/2,m=this.game.height/2;e.save(),e.textAlign="left",e.fillStyle="red",e.font='30px "Press Start 2P"',e.fillText(r,n,m),r=`Time played: ${this.game.timer.min}min ${this.game.timer.s}s ${Math.floor(this.game.timer.ms)}ms`,e.textAlign="left",e.fillStyle="red",e.font='30px "Press Start 2P"',e.fillText(r,n,m+100),e.restore()}}}const I="/deadmoves/assets/BG-C00RDK4m.png",j="/deadmoves/assets/MG_FG-BB5SgHdI.png",k="/deadmoves/assets/Nisse_SpriteSheet_NoGrid-DEBDfZOi.png";class L extends o{constructor(e,i,s,r,n,m,d,l){super(e,i,s,d,l,"",r,n);t(this,"game");t(this,"img",new Image);t(this,"frameX",0);t(this,"frameY",0);t(this,"maxFrames",0);t(this,"timer",0);t(this,"speedX",0);t(this,"speedY",0);t(this,"flip",!1);t(this,"moveLeft");t(this,"dead",!1);t(this,"healthbar");t(this,"jumpKilled",!1);this.game=e,this.moveLeft=m,this.img.src=k,this.flip=!m,this.speedX=this.moveLeft?-this.maxSpeedX:this.maxSpeedX,this.health=40,this.healthbar=new g(this.game,this,d*.8,9.5)}update(e){if(this.flip=!this.moveLeft,this.dead&&(this.speedY+=this.maxSpeedY),this.x+=this.speedX*this.maxSpeedX,this.y+=this.speedY*this.maxSpeedY,this.timer>this.game.interval)this.frameX++,this.timer=0;else{this.timer+=e;return}this.frameX>=this.maxFrames&&(this.frameX=0),this.jumpKill()||(this.dead?(this.frameY=1,this.maxFrames=6):(this.frameY=0,this.maxFrames=6))}draw(e){this.flip&&(e.save(),e.scale(-1,1)),e.drawImage(this.img,240+this.frameX*240,240*this.frameY,240,240,this.flip?-this.x-this.width:this.x,this.y,this.width,this.height),this.flip&&e.restore(),this.healthbar.draw(e)}jumpKill(e=!1){return!e&&this.frameY!=2||this.jumpKilled?!1:(e&&this.frameY!=2?(this.frameX=0,this.frameY=2,this.maxFrames=5,this.speedX=0,this.dead=!0):this.frameX===0&&(this.frameY=0,this.maxFrames=6,this.jumpKilled=!0),!0)}updateHealth(e){this.health-=e,this.health<=0&&(this.dead=!0)}}class u extends o{constructor(e,i,s,r,n,m,d,l,w,y){super(e,s,r,w,y,"",m,d);t(this,"enemies",[]);t(this,"moveLeft",!1);t(this,"minSpeedX",0);t(this,"chance",0);if(i>=1||i<=0)throw new Error("chance needs to be between 0 and 1");if(this.chance=i,n>d)throw new Error("minSpeedX has to be smaller than maxSpeedX");if(n<=0)throw new Error("minSpeedX has to be greater than 0");this.minSpeedX=n,this.moveLeft=l,setInterval(()=>{this.tidy()},2e3)}update(e){this.enemies.forEach(i=>{i.update(e)}),this.spawn()}draw(e){this.enemies.forEach(i=>{i.draw(e)})}tidy(){let e=this.enemies.length-1;for(let i=e;i>=0;i--){const s=this.enemies[i];(s.y+s.height<0||s.y>this.game.height||s.x+s.width<0||s.x>this.game.width)&&(console.debug("removed enemy",s,i,e),this.enemies[i]=this.enemies[e],e--)}this.game.score.addKills(this.enemies.length-e-1),this.enemies=this.enemies.slice(0,e+1)}spawn(){if(Math.random()>this.chance)return;const e=new L(this.game,this.x,this.y,Math.random()*(this.maxSpeedX-this.minSpeedX)+this.minSpeedX,this.maxSpeedY,this.moveLeft,this.width,this.height);console.debug("spawned new enemy",e),this.enemies.push(e)}}class F extends o{constructor(e,i,s,r){super(e,i,s,r,0,"000",0,0);t(this,"min",0);t(this,"s",0);t(this,"ms",0);t(this,"multiplier",1)}update(e){this.game.titlescreen.paused||!this.game.titlescreen.running||(this.ms+=e,this.ms>=1e3&&(this.s+=1,this.ms-=1e3,this.s>=60&&(this.min+=1,this.s-=60)))}draw(e){let i="";this.min>0&&(i=`${this.min}:`),this.s<10&&(i+="0"),i+=`${this.s}`,e.save(),e.textAlign="left",e.fillStyle="red",e.font='30px "Press Start 2P"',e.fillText(i,this.x,this.y,this.width),e.restore()}}class R extends o{constructor(e,i,s,r,n){super(e,s,r,n,0,"000",0,0);t(this,"score",0);t(this,"timer");t(this,"multiplier",1);t(this,"running",!1);this.timer=i}update(e){this.multiplier=Math.max((this.timer.min+this.timer.s/100)**2,1),this.score+=e/1e3*this.multiplier}draw(e){const i=`Score ${Math.floor(this.score)}`;e.save(),e.textAlign="left",e.fillStyle="red",e.font='30px "Press Start 2P"',e.fillText(i,this.x,this.y,this.width),e.restore()}addKills(e){this.running&&(this.score+=100*e*this.multiplier)}toggle(e){this.running=e}}class D{constructor(h,e){t(this,"fps",12);t(this,"interval",1e3/this.fps);t(this,"speed",1);t(this,"width");t(this,"height");t(this,"gravity",900);t(this,"enemiesLeft");t(this,"enemiesRight");t(this,"player");t(this,"input");t(this,"background");t(this,"overlay");t(this,"titlescreen");t(this,"deathscreen");t(this,"timer");t(this,"score");this.width=h,this.height=e,this.enemiesLeft=new u(this,.01,-240,470,1,8,1,!1,240,240),this.enemiesRight=new u(this,.01,h,470,1,8,1,!0,240,240),this.player=new Y(this,this.width/2-340/2,480/2,1,600,100,340,480),this.input=new p(this),this.background=new f(this,I,h,e,0,0,0),this.overlay=new f(this,j,h,e,0,0,0),this.titlescreen=new P(this),this.deathscreen=new x(this);const i=4.7*this.width/7;this.timer=new F(this,i,75,this.width/7),this.score=new R(this,this.timer,i+200,75,this.width/7)}update(h){this.titlescreen.update(h),!(!this.titlescreen.running||this.titlescreen.paused)&&(this.player.update(h),this.background.update(h),this.enemiesLeft.update(h),this.enemiesRight.update(h),this.deathscreen.update(h),this.score.toggle(!this.deathscreen.dead),this.deathscreen.dead||(this.timer.update(h),this.score.update(h)))}draw(h){if(!this.titlescreen.running){this.titlescreen.draw(h);return}this.titlescreen.paused&&this.titlescreen.draw(h),this.background.draw(h),this.player.draw(h),this.enemiesLeft.draw(h),this.enemiesRight.draw(h),this.overlay.draw(h),this.timer.draw(h),this.score.draw(h),this.deathscreen.draw(h)}}function G(a){const h=a.getContext("2d");if(!h)throw new Error("No game canvas found");a.width=window.innerWidth,a.height=window.innerHeight;const e=new D(a.width,a.height);e.input=new p(e);let i=0;const s=r=>{const n=r-i;i=r,h.clearRect(0,0,a.width,a.height),e.update(n),e.draw(h),requestAnimationFrame(s)};s(0)}const c=document.querySelector("#game");if(!c)throw new Error("Game canvas not defined");G(c);
0
